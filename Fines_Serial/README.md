# Fines_Serial
## 通信协议
| 字段名称    | 字节长度 (Bytes) | 数据类型      | 说明                                    |
|---------|--------------|-----------|---------------------------------------|
| 起始字节    | 1            | uint8_t   | 固定为0xAA，用于表示数据包的开始                    |
| dataID  | 1            | uint8_t   | 表示操作的类型（例如：0x01表示机械臂角度，0x02表示机械臂夹爪控制） |
| 数据长度    | 1            | uint8_t   | 数据字段的长度，表示数据部分的字节数                    |
| 数据字段    | N (可变)       | uint8_t[] | 传输的实际数据，根据数据长度字段确定大小                  |
| CRC-8校验 | 1            | uint8_t   | 所有数据字节的异或校验，用于确保数据完整性                 |
| 结束字节    | 1            | uint8_t   | 固定为0XBB，用于表示数据包的结束                    |

| dataID | 数据类型    |
|--------|---------|
| 0x00   | Debug   |
| 0x10   | cmd_vel |


## 数据包实例
| 字段名称    | 数据内容     | 数据类型      | 说明                       |
|---------|----------|-----------|--------------------------|
| 起始字节    | AA       | uint8_t   | 固定为AA，用于表示数据包的开始         |
| dataID  | 00       | uint8_t   | 表示操作的类型（0x00表示调试）        |
| 数据长度    | 04       | uint8_t   | 数据字段的长度，表示数据部分的字节数 传4个字节 |
| 数据字段    | 3C3D3E3F | uint8_t[] | 传输的实际数据，根据数据长度字段确定大小     |
| CRC-8校验 | 0xA3     | uint8_t   | 校验位                      |
| 结束字节    | BB       | uint8_t   | 固定为BB，用于表示数据包的结束         |

## Note
* 测试环境下(波特率921600,自发自收),对数据段为25Bytes的数据进行测试(目前强烈建议数据段长度不超过25Bytes)
  * 不丢包，不错包前提下，允许最高以300Hz收发
  * 1000Hz收发时，丢包率约为3%
  * 峰值收发频率可以超过1000Hz，此时内部的发送队列已经在不断积累任务，产生通信时延
## TODO
- [ ] 当数据段过长时，接收数据会出现分段接收，需要调查优化
- [ ] 当收发频率过高时，丢包率逐渐增加，后续需要考虑将内部收发工作改为多线程实现
- [ ] 当收发频率过高时（超过300Hz）,接收的数据段会在帧尾字节后附加一个帧头字节，怀疑是在处理接收缓冲区时，复制效率过低，需进一步优化